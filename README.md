# Secrets

We are using age for encrypting, so first we need to create a encryption key

    age-keygen -o key.agekey

It will create a `key.agekey` file and output the public key. The public key should be stored in a repository as is, 
so future secrets can also be generated with it.

Add the secret key (the `key.agekey` file) to the k8s cluster as a secret:

    cat key.agekey | kubectl -n <NAMESPACE> create secret generic <SECRET_NAME> --from-file=age.agekey=/dev/stdin

At this point you can (and you should) delete the `key.agekey` file, making the cluster the only one able to decrypt
secrets generated by this key.

## Add secrets to FluxCD

Run this command from your fluxcd configuration:

    flux create source git <SOURCE_ID> --url=https://github.com/raul-driftbio/secrets-repository --branch=master --interval=30s --export > ./clusters/my-cluster/<SOURCE_ID>.yaml

It will create the `<SOURCE_ID>.yaml` file inside your flux controlled repository. Commit and push it so fluxcd adds the source.
